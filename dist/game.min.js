/*! Leo-Engine copyright (c) 2015 Magnus Leo.  All rights reserved. */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){var c,d,e;e=a("./core"),d=a("./Sprite"),b.exports=c=function(){function a(a){var b,c;this.posX=0,this.posY=0,this.speedX=0,this.speedY=0;for(b in a)c=a[b],this[b]=c;e.actors.push(this)}return a.prototype.draw=function(){return this.sprite.draw(this.posX,this.posY)},a.prototype.setSprite=function(a){if(!(a instanceof d))throw"Actor::setSprite - Missing Sprite";return this.sprite=a},a.prototype.update=function(a){return this.sprite.advanceAnimation(a),this.posX+=this.speedX*a,this.posY+=this.speedY*a},a.prototype.decelerate=function(a,b){var c,d;if(b)return a=a.toUpperCase(),d="speed"+a,c=this[d],this[d]=c>0?Math.max(c-b,0):Math.min(c+b,0)},a}()},{"./Sprite":9,"./core":12}],2:[function(a,b){var c,d,e;d=a("./Frame"),e=a("./util"),b.exports=c=function(){function a(a,b){var c,d,f,g,h;if(c={isLooping:!1},this.options=e.merge(c,b),!a)throw"Missing animation sprite";for(this.sprite=a,this.frameTimeLeft=0,this.frameNum=0,this.name=b.name,this.frames=[],h=this.options.frames,f=0,g=h.length;g>f;f++)d=h[f],this.addFrame(d)}return a.prototype.addFrame=function(a){if(a instanceof d||(a=new d(a)),!(a instanceof d))throw"Animation::addFrame - Missing Frame";return this.frames.push(a)},a.prototype.advance=function(a){var b,c;for(b=this.frames.length-1,this.frameNum=Math.min(this.frameNum,b),this.frameTimeLeft-=a,c=[];this.frameTimeLeft<0;)this.frameNum++,this.frameNum>b&&(this.options.isLooping?this.frameNum=0:this.frameNum--),c.push(this.frameTimeLeft=this.frames[this.frameNum].data[6]+this.frameTimeLeft);return c},a.prototype.jumpToFrame=function(a){return a=Math.min(a,this.frames.length-1),a=Math.max(a,0),this.frameNum=a,this.frameTimeLeft=this.frames[a].data[6]},a.prototype.getCurrentFrame=function(){return this.frames[this.frameNum]},a}()},{"./Frame":3,"./util":18}],3:[function(a,b){var c,d;d=a("./util"),b.exports=c=function(){function a(a){var b;b={x:0,y:0,w:16,h:16,offsetX:0,offsetY:0,duration:200},a=d.merge(b,a),this.data=[a.x,a.y,a.w,a.h,a.offsetX,a.offsetY,a.duration]}return a}()},{"./util":18}],4:[function(a,b){var c,d,e,f,g,h;f=a("./core"),e=a("./background"),g=a("./layers"),h=a("./view"),b.exports=d=function(){function a(a){var b,d,e,f,h,i,j,k;this.spritesheet="",this.chunks=[{chunkOffsetX:0,chunkOffsetY:0,colBoxes:[],tileOffsetX:0,tileOffsetY:0,tiles:[]}],this.isLooping=!1,this.parallax=1;for(e in a)h=a[e],this[e]=h;for(this.spriteImg=g.getImg(this.spritesheet),f=this,this.spriteImg.addEventListener("load",function(){var a,b,c,d;if(f.chunks)for(d=f.chunks,b=0,c=d.length;c>b;b++)a=d[b],a.redraw()}),this.layerNumTilesX=0,k=this.chunks,d=i=0,j=k.length;j>i;d=++i)b=k[d],this.chunks[d]=new c(this,b),this.layerNumTilesX+=b.tiles.length+b.tileOffsetX}return a.prototype.draw=function(){var a,b,c,d,g,i,j,k,l,m;if(this.isLooping)for(a=this.chunks[0],c=h.posToPx(a.tileOffsetX+a.chunkOffsetX,"x",this.parallax),b=(h.cameraPosX/this.layerNumTilesX*this.parallax>>0)-1,c+=this.layerNumTilesX*e.tileSize*b;c<f.camW;)for(l=this.chunks,g=0,j=l.length;j>g;g++)a=l[g],d=h.posToPx(a.tileOffsetY+a.chunkOffsetY,"y"),a.draw(c,d),c+=a.drawBuffer.width+a.tileOffsetXPx;else for(m=this.chunks,i=0,k=m.length;k>i;i++)a=m[i],c=h.posToPx(a.tileOffsetX+a.chunkOffsetX,"x",this.parallax),d=h.posToPx(a.tileOffsetY+a.chunkOffsetY,"y"),a.draw(c,d)},a.prototype.getTile=function(a,b,c,d){var e,f,g,h;return null==c&&(c=0),null==d&&(d=0),f=Math.floor((a+c)/this.chunks[0].width),0>f||f>this.chunks.length-1?-1:(e=this.chunks[f],g=a-e.tileOffsetX+c-e.width*f,h=b-e.tileOffsetY+d,0>g&&g>e.width||0>h&&h>e.width?-1:e.tiles[g+h*e.width]||-1)},a.prototype.setTile=function(a,b,c){var d,e,f,g;return e=a/this.chunks[0].width>>0,d=this.chunks[e],d.drawBufferDirty=!0,f=a-d.tileOffsetX-d.width*e,g=b-d.tileOffsetY,d.tiles[f+g*d.width]=c},a.prototype.serialize=function(){var a,b,c,d,e,g;for(c="",g=this.chunks,d=0,e=g.length;e>d;d++)a=g[d],c+=String.fromCharCode(f.DATA_TYPES.CHUNK),b=a.serialize(),c+=String.fromCharCode(b.length)+b;return c},a.prototype.deserialize=function(a){var b,d,e,g,h,i;for(b=0,this.chunks.length=0,h=f.DATA_TYPES,d=0,i=[];d<a.length;){switch(e=a.charCodeAt(d+1),a.charCodeAt(d)){case h.CHUNK:g=this.chunks.push(new c(this,{width:30,height:17,chunkOffsetX:b,chunkOffsetY:0,tileOffsetX:0,tileOffsetY:13})),this.chunks[g-1].deserialize(a.substr(d+2,e)),b+=30}i.push(d+=2+e)}return i},a}(),c=function(){function a(a,b){var c,d;this.tiles=[];for(d in b)c=b[d],this[d]=c;this.layer=a,this.drawBuffer=document.createElement("canvas"),this.drawBufferCtx=this.drawBuffer.getContext("2d"),this.drawBufferDirty=!0,this.drawBuffer.width=this.width*e.tileSize,this.drawBuffer.height=(this.tiles.length/this.width>>0)*e.tileSize,this.tileOffsetXPx=this.tileOffsetX*e.tileSize}return a.prototype.draw=function(a,b){var c,d,g,h,i;if(!(a<-this.drawBuffer.width||a>f.camW||b<-this.drawBuffer.height||b>f.camH)){if(this.drawBufferDirty){for(this.drawBufferCtx.clearRect(0,0,this.drawBuffer.width,this.drawBuffer.height),c=h=0,i=this.tiles.length;i>=0?i>=h:h>=i;c=i>=0?++h:--h)d=c%this.width,g=c/this.width>>0,this.drawTile(this.drawBufferCtx,this.tiles[c],d*e.tileSize,(g+this.chunkOffsetY)*e.tileSize);this.drawBufferDirty=!1}return f.frameBufferCtx.drawImage(this.drawBuffer,0,0,this.drawBuffer.width,this.drawBuffer.height,a,b,this.drawBuffer.width,this.drawBuffer.height)}},a.prototype.redraw=function(){return this.drawBufferDirty=!0},a.prototype.drawTile=function(a,b,c,d){var f,g,h,i;if(-1!==b)return i=e.tileSize,f=16,g=b%f,h=b/f>>0,a.drawImage(this.layer.spriteImg,g*i,h*i,i,i,c>>0,d>>0,i,i)},a.prototype.serialize=function(){var a,b,c,d,e;for(a="",e=this.tiles,c=0,d=e.length;d>c;c++)b=e[c],a+=String.fromCharCode(b+1);return a},a.prototype.deserialize=function(a){var b,c,d;for(this.drawBufferDirty=!0,this.tiles.length=0,b=c=0,d=a.length;d>=0?d>=c:c>=d;b=d>=0?++c:--c)this.tiles.push(a.charCodeAt(b)-1);return this.drawBuffer.height=(this.tiles.length/this.width>>0)*e.tileSize},a}()},{"./background":10,"./core":12,"./layers":16,"./view":19}],5:[function(a,b){var c,d,e,f,g,h={}.hasOwnProperty,i=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};d=a("./Shape"),f=a("./util"),e=a("./core"),g=a("./view"),b.exports=c=function(a){function b(a){var c;c={x2:0,y2:0},a=f.merge(c,a),b.__super__.constructor.call(this,a)}return i(b,a),b.prototype.draw=function(){return b.__super__.draw.apply(this,arguments)?(e.frameBufferCtx.beginPath(),e.frameBufferCtx.moveTo(this.drawX,this.drawY),e.frameBufferCtx.lineTo(g.posToPx(this.x2,"x"),g.posToPx(this.y2,"y")),e.frameBufferCtx.closePath(),e.frameBufferCtx.stroke(),!0):!1},b}(d)},{"./Shape":8,"./core":12,"./util":18,"./view":19}],6:[function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r={}.hasOwnProperty,s=function(a,b){function c(){this.constructor=a}for(var d in b)r.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};c=a("./Actor"),l=a("./collision"),m=a("./environment"),n=a("./event"),o=a("./io"),p=a("./layers"),q=a("./util"),b.exports=d=function(a){function b(){b.__super__.constructor.apply(this,arguments),this.accX=0,this.dirPhysical=0,this.dirVisual=1,this.state=new k(this),this.stateBefore=null}return s(b,a),b.prototype.setState=function(a){return this.state instanceof a?void 0:(this.stateBefore=this.state,this.state=new a(this))},b.prototype.stateIs=function(a){return this.state instanceof a},b.prototype.handleInput=function(a){return this.state.handleInput(a)},b.prototype.update=function(a){var c;return this.speedY+=m.gravity*a,this.speedX+=this.accX*a,this.speedX=Math.min(this.speedX,this.speedXMax),this.speedX=Math.max(this.speedX,-this.speedXMax),b.__super__.update.call(this,a),this.state.update(a),c=l.actorToLayer(this,p.get("ground"),{reposition:!0}),c.bottom?0===this.dirPhysical?(this.setState(k),this.decelerate("x",c.friction*this.decelerationGround*a)):this.setState(j):this.stateIs(i)||(this.setState(g),0!==this.dirPhysical)?void 0:this.decelerate("x",this.decelerationAir*a)},b}(c),e=e=function(){function a(a){this.parent=a}return a.prototype.handleInput=function(a){var b;switch(b=q.KEY_CODES,a.keyCode){case b.LEFT:return this.parent.dirPhysical=-1,this.parent.dirVisual=-1;case b.RIGHT:return this.parent.dirPhysical=1,this.parent.dirVisual=1}},a.prototype.update=function(){},a}(),h=h=function(a){function b(a){b.__super__.constructor.call(this,a)}return s(b,a),b.prototype.handleInput=function(a){var c;if(b.__super__.handleInput.call(this,a),c=q.KEY_CODES,"keydown"===a.type)switch(a.keyCode){case c.UP:case c.Z:return this.parent.setState(i)}},b}(e),k=k=function(a){function b(a){b.__super__.constructor.call(this,a),this.parent.accX=0,this.parent.sprite.setAnimation(this.parent.dirVisual>0?"standingRight":"standingLeft")}return s(b,a),b.prototype.handleInput=function(a){var c;if(b.__super__.handleInput.call(this,a),c=q.KEY_CODES,"keydown"===a.type)switch(a.keyCode){case c.LEFT:case c.RIGHT:return this.parent.setState(j)}},b}(h),j=j=function(a){function b(a){b.__super__.constructor.call(this,a),this._setSpeedAndAnim(),this.parent.stateBefore instanceof f&&this.parent.sprite.getCurrentAnimation().jumpToFrame(1)}return s(b,a),b.prototype.handleInput=function(a){var c,d,e;if(b.__super__.handleInput.call(this,a),c=q.KEY_CODES,"keydown"===a.type)switch(a.keyCode){case c.LEFT:case c.RIGHT:return this._setSpeedAndAnim()}else if("keyup"===a.type)switch(a.keyCode){case c.LEFT:case c.RIGHT:return e=o.isKeyPressed(c.RIGHT),d=o.isKeyPressed(c.LEFT),d||e?d&&!e?(this.parent.dirPhysical=-1,this.parent.dirVisual=-1,this._setSpeedAndAnim({frameNum:1})):(this.parent.dirPhysical=1,this.parent.dirVisual=1,this._setSpeedAndAnim({frameNum:1})):(this.parent.setState(k),this.parent.dirPhysical=0,this.parent.accX=0)}},b.prototype._setSpeedAndAnim=function(a){return null==a&&(a={}),this.parent.accX=this.parent.accelerationGround*this.parent.dirPhysical,this.parent.dirVisual>0?this.parent.sprite.setAnimation("runningRight",a.frameNum):this.parent.sprite.setAnimation("runningLeft",a.frameNum)},b}(h),f=f=function(a){function b(){b.__super__.constructor.apply(this,arguments),this.parent.sprite.setAnimation(this.parent.dirVisual>0?"jumpingRight":"jumpingLeft")}return s(b,a),b.prototype.handleInput=function(a){var c,d,e;if(b.__super__.handleInput.apply(this,arguments),c=q.KEY_CODES,"keydown"===a.type)switch(a.keyCode){case c.LEFT:case c.RIGHT:return this._setSpeedAndAnim()}else if("keyup"===a.type)switch(a.keyCode){case c.LEFT:case c.RIGHT:return e=o.isKeyPressed(c.RIGHT),d=o.isKeyPressed(c.LEFT),d||e?d&&!e?(this.parent.dirPhysical=-1,this.parent.dirVisual=-1,this._setSpeedAndAnim({frameNum:1})):(this.parent.dirPhysical=1,this.parent.dirVisual=1,this._setSpeedAndAnim({frameNum:1})):(this.parent.dirPhysical=0,this.parent.accX=0)}},b.prototype._setSpeedAndAnim=function(){return this.parent.accX=this.parent.accelerationAir*this.parent.dirPhysical,this.parent.sprite.setAnimation(this.parent.dirVisual>0?"jumpingRight":"jumpingLeft")},b.prototype.update=function(){return b.__super__.update.apply(this,arguments)},b}(e),i=i=function(a){function b(){b.__super__.constructor.apply(this,arguments),this.parent.speedY=-21}return s(b,a),b.prototype.handleInput=function(a){var c;if(b.__super__.handleInput.apply(this,arguments),c=q.KEY_CODES,"keyup"===a.type)switch(a.keyCode){case c.UP:case c.Z:return this.parent.speedY*=.5,this.parent.setState(g)}},b.prototype.update=function(){return this.parent.speedY>=0?this.parent.setState(g):void 0},b}(f),g=g=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return s(b,a),b}(f)},{"./Actor":1,"./collision":11,"./environment":13,"./event":14,"./io":15,"./layers":16,"./util":18}],7:[function(a,b){var c,d,e,f={}.hasOwnProperty,g=function(a,b){function c(){this.constructor=a}for(var d in b)f.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};d=a("./Shape"),e=a("./core"),b.exports=c=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return g(b,a),b.prototype.draw=function(){return b.__super__.draw.apply(this,arguments)?(e.frameBufferCtx.fillRect(this.drawX,this.drawY,this.drawW,this.drawH),!0):!1},b}(d)},{"./Shape":8,"./core":12}],8:[function(a,b){var c,d,e,f,g;e=a("./core"),d=a("./background"),f=a("./util"),g=a("./view"),b.exports=c=function(){function a(a){var b,c,d;b={fillStyle:"rgba(255,0,0,0.4)",strokeStyle:"rgba(255,0,0,0.7)",h:1,w:1,x:0,y:0},a=f.merge(b,a);for(c in a)d=a[c],this[c]=d;e.shapes.push(this)}return a.prototype.draw=function(){return this.isVisible?(this.drawX=g.posToPx(this.x,"x"),this.drawY=g.posToPx(this.y,"y"),this.drawW=this.w*d.tileSize,this.drawH=this.h*d.tileSize,e.frameBufferCtx.fillStyle=this.fillStyle,e.frameBufferCtx.strokeStyle=this.strokeStyle,!0):!1},a}()},{"./background":10,"./core":12,"./util":18,"./view":19}],9:[function(a,b){var c,d,e,f;c=a("./Animation"),e=a("./core"),f=a("./view"),b.exports=d=function(){function a(a){this.spritesheet=a,this.spriteImg=this.getImg(a),this.animations={},this.currentAnimation=null}return a.prototype.addAnimation=function(a){if(!a)throw"Sprite::addAnimation - Missing animationData";if(!a.name)throw"Sprite::addAnimation - Missing animationData.name";return console.assert(!this.animations[a.name]),this.animations[a.name]=new c(this,a)},a.prototype.setAnimation=function(a,b){return null==b&&(b=0),this.currentAnimation=a,this.animations[this.currentAnimation].jumpToFrame(b)},a.prototype.advanceAnimation=function(a){return this.animations[this.currentAnimation].advance(a)},a.prototype.getCurrentAnimation=function(){return this.animations[this.currentAnimation]},a.prototype.draw=function(a,b){var c,d;return c=this.animations[this.currentAnimation].getCurrentFrame(),d=c.data,e.frameBufferCtx.drawImage(this.spriteImg,d[0],d[1],d[2],d[3],f.posToPx(a,"x")+d[4],f.posToPx(b,"y")+d[5],d[2],d[3])},a.prototype.getImg=function(){var a,b,c;return a=this.spritesheet,(b=this._img[a])?b[a]:(c=this._img[a]=new Image,c.src=e.imgPath+a,c)},a.prototype._img={},a}()},{"./Animation":2,"./core":12,"./view":19}],10:[function(a,b){var c;b.exports=c={tileSize:16,color:"#6ec0ff"}},{}],11:[function(a,b){var c,d,e,f,g;e={},b.exports=e,c=a("./Line"),d=a("./Rect"),f=a("./util"),g=a("./view"),e.actorToLayer=function(a,b,e){var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B;for(u={reposition:!1},u=f.merge(u,e),k={any:!1,bottom:!1,top:!1,left:!1,right:!1,friction:1},q=a.posX,r=a.posY,s=a.speedX,t=a.speedY,v=a.posX>>0,l=a.posX+a.colW>>0,w=a.posY>>0,m=a.posY+a.colH>>0,z=A=w;m>=w?m>=A:A>=m;z=m>=w?++A:--A)for(y=B=v;l>=v?l>=B:B>=l;y=l>=v?++B:--B)x=b.getTile(y,z),x>-1&&(0===a.speedX?n=!1:0===a.speedY?n=!0:(h={},i={},a.speedX>0?(h.x=a.posX+a.colW,i.x=y):(h.x=a.posX,i.x=y+1),a.speedY>0?(h.y=a.posY+a.colH,i.y=z):(h.y=a.posY,i.y=z+1),o=Math.abs(a.speedY/a.speedX),j=Math.abs((h.y-i.y)/(h.x-i.x)),n=.01>o-j?!0:!1),n?a.speedX>0?(p=b.getTile(y,z,-1,0),-1===p?(q=y-a.colW-.01,s=0,k.any=!0,k.right=!0,g.drawOnce({"class":c,x:y,y:z,x2:y,y2:z+1,strokeStyle:"rgba(0,128,0,0.9)"})):g.drawOnce({"class":c,x:y,y:z,x2:y,y2:z+1,strokeStyle:"rgba(255,64,0,0.6)"})):(p=b.getTile(y,z,1,0),-1===p?(q=y+1,s=0,k.any=!0,k.left=!0,g.drawOnce({"class":c,x:y+1,y:z,x2:y+1,y2:z+1,strokeStyle:"rgba(0,128,0,0.9)"})):g.drawOnce({"class":c,x:y+1,y:z,x2:y+1,y2:z+1,strokeStyle:"rgba(255,64,0,0.6)"})):a.speedY<0?(p=b.getTile(y,z,0,1),-1===p?(r=z+1,t=0,k.any=!0,k.top=!0,g.drawOnce({"class":c,x:y,y:z+1,x2:y+1,y2:z+1,strokeStyle:"rgba(0,128,0,0.9)"})):g.drawOnce({"class":c,x:y,y:z+1,x2:y+1,y2:z+1,strokeStyle:"rgba(255,64,0,0.6)"})):a.speedY>0&&(p=b.getTile(y,z,0,-1),-1===p?(r=z-a.colH,t=0,k.any=!0,k.bottom=!0,g.drawOnce({"class":c,x:y,y:z,x2:y+1,y2:z,strokeStyle:"rgba(0,128,0,0.9)"})):g.drawOnce({"class":c,x:y,y:z,x2:y+1,y2:z,strokeStyle:"rgba(255,64,0,0.6)"})),g.drawOnce(-1===p?{"class":d,x:y,y:z,w:1,h:1,fillStyle:"rgba(0,255,0,0.6)"}:{"class":d,x:y,y:z,w:1,h:1,fillStyle:"rgba(255,255,0,0.5)"}));return u.reposition&&(a.posX=q,a.posY=r,a.speedX=s,a.speedY=t),k}},{"./Line":5,"./Rect":7,"./util":18,"./view":19}],12:[function(a,b){var c,d,e,f,g,h,i,j,k,l,m;c=a("./background"),e=a("./event"),f=a("./layers"),g=a("./util"),h=a("./view"),d={},b.exports=d,l=null,m=null,j=document.createElement("canvas"),k=Date.now(),i=-1,d.frameBufferCtx=j.getContext("2d"),d.camX=0,d.camY=0,d.camW=0,d.camH=0,d.actors=[],d.shapes=[],d.imgPath="_img/",d.init=function(){return l=document.getElementById("leo-view"),j.width=l.width,j.height=l.height,l.width=l.width*h.scale,l.height=l.height*h.scale,m=l.getContext("2d"),m.imageSmoothingEnabled=m.webkitImageSmoothingEnabled=m.mozImageSmoothingEnabled=!1,l.addEventListener("mousedown",function(a){var b,d,e,g,j,k,l,m,n,o;if(0===a.button)return a.preventDefault(),g=a.offsetX,j=a.offsetY,b=h.cameraPosX,d=h.cameraPosY,k=h.scale,m=c.tileSize,n=g/k/m+b>>0,o=j/k/m+d>>0,e=f.get("ground"),l=e.getTile(n,o),console.log(n,o),a.altKey?i=l:e.setTile(n,o,i)}),l.addEventListener("mouseup",function(a){return a.preventDefault()}),window.addEventListener("keydown",e._keydown),window.addEventListener("keyup",e._keyup),window.requestAnimationFrame(d.cycle)},d.draw=function(){var a,b,e,i,k,n,o,p,q,r,s,t,u,v,w;if(!g.documentHidden()){for(d.camX=h.cameraPosX*c.tileSize,d.camY=h.cameraPosY*c.tileSize,d.camW=h.cameraWidth*c.tileSize,d.camH=h.cameraHeight*c.tileSize,d.frameBufferCtx.fillStyle=c.color,d.frameBufferCtx.fillRect(0,0,l.width,l.height),u=f.objects,o=0,r=u.length;r>o;o++)b=u[o],b.draw();for(v=d.actors,p=0,s=v.length;s>p;p++)a=v[p],a.draw();for(w=d.shapes,q=0,t=w.length;t>q;q++)i=w[q],i.draw();for(;k=h.drawOnceQue.pop();){i=new k["class"];for(e in k)n=k[e],i[e]=n;i.isVisible=!0,i.draw(),i.isVisible=!1}return m.drawImage(j,0,0,j.width*h.scale,j.height*h.scale)}},d.cycle=function(){var a,b,c,e,f,g;if(c=Date.now(),b=.001*Math.min(c-k,100)){for(h.cameraPosX+=h.cameraSpeedX*b,g=d.actors,e=0,f=g.length;f>e;e++)a=g[e],a.update(b);return d.draw(),k=c,window.requestAnimationFrame(d.cycle),d.cycleCallback(b)}},d.DATA_TYPES={CHUNK:0},d.cycleCallback=function(){}},{"./background":10,"./event":14,"./layers":16,"./util":18,"./view":19}],13:[function(a,b){var c;b.exports=c={gravity:60}},{}],14:[function(a,b){var c,d,e;d=a("./layers"),e=a("./util"),c={},b.exports=c,c.pressedKeys=[],c._keydown=function(a){var b,f,g;if(a.ctrlKey||a.metaKey||a.preventDefault(),g=c.pressedKeys.indexOf(a.keyCode),-1===g){switch(c.pressedKeys.push(a.keyCode),f=e.KEY_CODES,a.keyCode){case f.S:b=d.get("ground").serialize(),localStorage.setItem("ground",b);break;case f.L:b=localStorage.getItem("ground"),d.get("ground").deserialize(b)}return c.keydown(a)}},c.keydown=function(){},c._keyup=function(a){var b;return a.preventDefault(),b=c.pressedKeys.indexOf(a.keyCode),-1!==b&&c.pressedKeys.splice(b,1),c.keyup(a)},c.keyup=function(){}},{"./layers":16,"./util":18}],15:[function(a,b){var c,d,e;e=a("./util"),c=a("./event"),d={},b.exports=d,d.getPressedKeys=function(){return c.pressedKeys},d.isKeyPressed=function(a){return"string"==typeof a&&(a=e.KEY_CODES[a.toUpperCase()]),"number"!=typeof a?!1:c.pressedKeys.indexOf(a)>-1},d.anyKeyPressed=function(a){var b,d,f,g;for(d=e.KEY_CODES,"string"==typeof b&&(b=[b]),f=0,g=a.length;g>f;f++)if(b=a[f],"string"==typeof b&&(b=d[b.toUpperCase()]),c.pressedKeys.indexOf(b)>-1)return!0;return!1},d.allKeysPressed=function(a){var b,d,f,g;for(d=e.KEY_CODES,"string"==typeof b&&(b=[b]),f=0,g=a.length;g>f;f++)if(b=a[f],"string"==typeof b&&(b=d[b.toUpperCase()]),-1===c.pressedKeys.indexOf(b))return!1;return!0}},{"./event":14,"./util":18}],16:[function(a,b){var c;c={},b.exports=c,c.objects=[],c.add=function(a){return!(null!=a?a.id:void 0)||c.get(a.id)?null:c.objects.push(a)},c.get=function(a){var b,d,e,f;for(f=c.objects,d=0,e=f.length;e>d;d++)if(b=f[d],b.id===a)return b;return null},c.getImg=function(a){var b,d;return b=c._img,b[a]?b[a]:(d=b[a]=new Image,d.src="_img/"+a,d)},c.removeImg=function(a){var b;return b=c._img,b[a]?b[a]=null:void 0},c._img={}},{}],17:[function(a){var b,c,d,e,f,g,h,i;e=a("./core"),f=a("./event"),b=a("./Layer"),g=a("./layers"),c=a("./Player"),d=a("./Sprite"),h=a("./util"),i=a("./view"),window.addEventListener("load",function(){var a,j;return e.init(),f.keydown=function(b){var c;switch(c=h.KEY_CODES,b.keyCode){case c.R:return window.location.reload();default:return a.handleInput(b)}},f.keyup=function(b){return a.handleInput(b)},j=new d("sprite-olle.png"),j.addAnimation({name:"jumpingLeft",frames:[{x:19,y:33,w:30,h:32,offsetX:-4,offsetY:0,duration:.192}],isLooping:!1}),j.addAnimation({name:"jumpingRight",frames:[{x:19,y:0,w:30,h:32,offsetX:-8,offsetY:0,duration:.192}],isLooping:!1}),j.addAnimation({name:"runningLeft",frames:[{x:19,y:33,w:30,h:32,offsetX:-6,offsetY:-1,duration:.18},{x:49,y:33,w:13,h:32,offsetX:1,offsetY:0,duration:.13},{x:62,y:33,w:23,h:32,offsetX:-4,offsetY:-1,duration:.18},{x:49,y:33,w:13,h:32,offsetX:1,offsetY:0,duration:.13}],isLooping:!0}),j.addAnimation({name:"runningRight",frames:[{x:19,y:0,w:30,h:32,offsetX:-9,offsetY:-1,duration:.18},{x:49,y:0,w:13,h:32,offsetX:1,offsetY:0,duration:.13},{x:62,y:0,w:23,h:32,offsetX:-4,offsetY:-1,duration:.18},{x:49,y:0,w:13,h:32,offsetX:1,offsetY:0,duration:.13}],isLooping:!0}),j.addAnimation({name:"standingLeft",frames:[{x:0,y:33,w:19,h:32,offsetX:1,offsetY:0,duration:1}],isLooping:!1}),j.addAnimation({name:"standingRight",frames:[{x:0,y:0,w:19,h:32,offsetX:-1,offsetY:0,duration:1}],isLooping:!1}),a=new c({sprite:j,posX:6,posY:6,colW:1,colH:2,speedXMax:9,accelerationAir:900,decelerationAir:900,accelerationGround:900,decelerationGround:900}),e.cycleCallback=function(){return i.cameraPosX=a.posX-15},g.add(new b({id:"mountains",spritesheet:"sprite-background.png",isLooping:!0,parallax:.5,chunks:[{chunkOffsetX:0,chunkOffsetY:0,colBoxes:[],tileOffsetX:0,tileOffsetY:10,tiles:[-1,5,6,-1,-1,-1,-1,-1,-1,-1,20,21,22,23,-1,-1,-1,27,28,-1,36,37,38,39,40,-1,42,43,44,45,52,53,54,55,56,57,58,59,60,61,68,69,70,71,72,73,74,75,76,77,68,68,68,68,68,68,68,68,68,68,7,8,9,10,11,7,8,9,10,11],width:10}]})),g.add(new b({id:"cloud 1",spritesheet:"sprite-background.png",isLooping:!0,parallax:.21,chunks:[{chunkOffsetX:50,chunkOffsetY:0,colBoxes:[],tileOffsetX:30,tileOffsetY:3,tiles:[0,1,2,3,16,17,18,19],width:4}]})),g.add(new b({id:"cloud 2",spritesheet:"sprite-background.png",isLooping:!0,parallax:.2,chunks:[{chunkOffsetX:0,chunkOffsetY:0,colBoxes:[],tileOffsetX:29,tileOffsetY:5,tiles:[0,1,2,3,16,17,18,19],width:4}]})),g.add(new b({id:"ground",spritesheet:"sprite-background.png",chunks:[{chunkOffsetX:0,chunkOffsetY:0,colBoxes:[],tileOffsetX:0,tileOffsetY:13,tiles:[-1,-1,-1,4,-1,-1,-1,-1,-1,-1,-1,32,34,33,35,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,32,33,34,33,35,-1,-1,-1,-1,-1,-1,-1,48,51,-1,-1,-1,-1,-1,-1,-1,32,33,34,33,34,33,34,33,35,48,49,50,49,50,33,34,35,-1,-1,-1,-1,48,51,-1,-1,-1,-1,32,33,34,50,49,50,49,50,49,50,49,51,48,49,50,49,50,49,50,49,34,33,34,33,50,49,34,33,34,33,50,49,50,50,49,50,49,50,49,50,49,51],width:30},{chunkOffsetX:30,chunkOffsetY:0,colBoxes:[],tileOffsetX:0,tileOffsetY:13,tiles:[-1,-1,-1,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,32,34,33,34,33,34,33,34,33,34,33,34,33,34,33,34,33,34,33,34,33,34,33,34,33,34,33,34,33,35,48,50,49,50,49,50,49,50,49,50,49,50,49,50,49,50,49,50,49,50,49,50,49,50,49,50,49,50,49,51,48,50,49,50,49,50,49,50,49,50,49,50,49,50,49,50,49,50,49,50,49,50,49,50,49,50,49,50,49,51],width:30}]}))})},{"./Layer":4,"./Player":6,"./Sprite":9,"./core":12,"./event":14,"./layers":16,"./util":18,"./view":19}],18:[function(a,b){var c;c={},b.exports=c,c.KEY_CODES={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE_BREAK:19,CAPS_LOCK:20,ESCAPE:27,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,LEFT_WINDOW_KEY:91,RIGHT_WINDOW_KEY:92,SELECT_KEY:93,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,"*":106,ADD:107,"+":107,SUBTRACT:109,DECIMAL_POINT:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUM_LOCK:144,SCROLL_LOCK:145,"SEMI-COLON":186,";":186,EQUAL_SIGN:187,"=":187,COMMA:188,",":188,DASH:189,"-":189,PERIOD:190,".":190,FORWARD_SLASH:191,"/":191,GRAVE_ACCENT:192,OPEN_BRACKET:219,"[":219,BACK_SLASH:220,"\\":220,CLOSE_BRAKET:221,"]":221,SINGLE_QUOTE:222,"'":222},c.documentHidden=function(){var a,b,c,d,e;if(c=["ms","moz","webkit","o"],a=0,null!=document.hidden)return document.hidden;for(d=0,e=c.length;e>d;d++)if(b=c[d],"undefined"!=typeof document[b+"Hidden"])return document[b+"Hidden"];return!1},c.merge=function(){var a,b,c,d,e,f;for(c={},e=0,f=arguments.length;f>e;e++)if(b=arguments[e],!("object"!=typeof b||b instanceof Array))for(a in b)d=b[a],c[a]=d;return c}},{}],19:[function(a,b){var c,d;c=a("./background"),d={},b.exports=d,d.scale=2,d.cameraPosX=2,d.cameraPosY=0,d.cameraSpeedX=0,d.cameraSpeedY=0,d.cameraWidth=30,d.cameraHeight=17,d.posToPx=function(a,b,e){return null==e&&(e=1),(a-d["cameraPos"+b.toUpperCase()])*c.tileSize*e>>0},d.drawOnceQue=[],d.drawOnce=function(a){return d.drawOnceQue.push(a)}},{"./background":10}]},{},[17]);