/*! Leo-Engine copyright (c) 2014 Magnus Leo.  All rights reserved. */

var Actor,Animation,Chunk,Frame,Layer,Leo,Line,Player,PlayerState,PlayerStateAir,PlayerStateFalling,PlayerStateGround,PlayerStateJumping,PlayerStateRunning,PlayerStateStanding,Rect,Shape,Sprite,_camH,_camW,_camX,_camY,_editTile,_frameBuffer,_frameBufferCtx,_latestFrameTime,_pressedKeys,_view,_viewCtx,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};!function(){var a,b,c;for(a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"],++c;return window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c,d,e;return c=(new Date).getTime(),e=Math.max(0,16-(c-a)),d=window.setTimeout(function(){return b(c+e)},e),a=c+e,d}),window.cancelAnimationFrame?void 0:window.cancelAnimationFrame=function(a){return clearTimeout(a)}}(),Leo=null!=window.Leo?window.Leo:window.Leo={},Leo.util={},Leo.util.KEY_CODES={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE_BREAK:19,CAPS_LOCK:20,ESCAPE:27,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,LEFT_WINDOW_KEY:91,RIGHT_WINDOW_KEY:92,SELECT_KEY:93,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,"*":106,ADD:107,"+":107,SUBTRACT:109,DECIMAL_POINT:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUM_LOCK:144,SCROLL_LOCK:145,"SEMI-COLON":186,";":186,EQUAL_SIGN:187,"=":187,COMMA:188,",":188,DASH:189,"-":189,PERIOD:190,".":190,FORWARD_SLASH:191,"/":191,GRAVE_ACCENT:192,OPEN_BRACKET:219,"[":219,BACK_SLASH:220,"\\":220,CLOSE_BRAKET:221,"]":221,SINGLE_QUOTE:222,"'":222},Leo.util.documentHidden=function(){var a,b,c,d,e;if(c=["ms","moz","webkit","o"],a=0,null!=document.hidden)return document.hidden;for(d=0,e=c.length;e>d;d++)if(b=c[d],"undefined"!=typeof document[b+"Hidden"])return document[b+"Hidden"];return!1},Leo.util.merge=function(){var a,b,c,d,e,f;for(c={},e=0,f=arguments.length;f>e;e++)if(b=arguments[e],!("object"!=typeof b||b instanceof Array))for(a in b)d=b[a],c[a]=d;return c},Leo=null!=window.Leo?window.Leo:window.Leo={},_view=null,_viewCtx=null,_frameBuffer=document.createElement("canvas"),_frameBufferCtx=_frameBuffer.getContext("2d"),_latestFrameTime=Date.now(),_pressedKeys=[],_camX=0,_camY=0,_camW=0,_camH=0,_editTile=-1,Leo.environment={gravity:60},Leo.view={scale:2,cameraPosX:2,cameraPosY:0,cameraSpeedX:0,cameraSpeedY:0,cameraWidth:30,cameraHeight:17},Leo.view.posToPx=function(a,b,c){return null==c&&(c=1),(a-Leo.view["cameraPos"+b.toUpperCase()])*Leo.background.tileSize*c>>0},Leo.view.drawOnceQue=[],Leo.view.drawOnce=function(a){return Leo.view.drawOnceQue.push(a)},Leo.background={tileSize:16,color:"#6ec0ff"},Leo.actors=[],Leo.shapes=[],Leo.core={},Leo.core.imgPath="_img/",Leo.core.init=function(){return _view=document.getElementById("leo-view"),Leo._view=_view,_frameBuffer.width=_view.width,_frameBuffer.height=_view.height,_view.width=_view.width*Leo.view.scale,_view.height=_view.height*Leo.view.scale,_viewCtx=_view.getContext("2d"),_viewCtx.imageSmoothingEnabled=_viewCtx.webkitImageSmoothingEnabled=_viewCtx.mozImageSmoothingEnabled=!1,_view.addEventListener("mousedown",function(a){var b,c,d,e,f,g,h,i,j,k;if(0===a.button)return a.preventDefault(),e=a.offsetX,f=a.offsetY,b=Leo.view.cameraPosX,c=Leo.view.cameraPosY,g=Leo.view.scale,i=Leo.background.tileSize,j=e/g/i+b>>0,k=f/g/i+c>>0,d=Leo.layers.get("ground"),h=d.getTile(j,k),console.log(j,k),a.altKey?_editTile=h:d.setTile(j,k,_editTile)}),_view.addEventListener("mouseup",function(a){return a.preventDefault()}),window.addEventListener("keydown",Leo.event._keydown),window.addEventListener("keyup",Leo.event._keyup),window.requestAnimationFrame(Leo.core.cycle)},Leo.core.draw=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;if(!Leo.util.documentHidden()){for(_camX=Leo.view.cameraPosX*Leo.background.tileSize,_camY=Leo.view.cameraPosY*Leo.background.tileSize,_camW=Leo.view.cameraWidth*Leo.background.tileSize,_camH=Leo.view.cameraHeight*Leo.background.tileSize,_frameBufferCtx.fillStyle=Leo.background.color,_frameBufferCtx.fillRect(0,0,_view.width,_view.height),n=Leo.layers.objects,g=0,j=n.length;j>g;g++)b=n[g],b.draw();for(o=Leo.actors,h=0,k=o.length;k>h;h++)a=o[h],a.draw();for(p=Leo.shapes,i=0,l=p.length;l>i;i++)d=p[i],d.draw();for(;e=Leo.view.drawOnceQue.pop();){d=null!=Leo[m="drawOnce"+e.shape]?Leo[m]:Leo[m]=new Leo[e.shape];for(c in e)f=e[c],d[c]=f;d.isVisible=!0,d.draw(),d.isVisible=!1}return _viewCtx.drawImage(_frameBuffer,0,0,_frameBuffer.width*Leo.view.scale,_frameBuffer.height*Leo.view.scale)}},Leo.core.cycle=function(){var a,b,c,d,e,f;if(c=Date.now(),b=.001*Math.min(c-_latestFrameTime,100)){for(Leo.view.cameraPosX+=Leo.view.cameraSpeedX*b,f=Leo.actors,d=0,e=f.length;e>d;d++)a=f[d],a.update(b);return Leo.core.draw(),_latestFrameTime=c,window.requestAnimationFrame(Leo.core.cycle),Leo.cycleCallback(b)}},Leo.core.DATA_TYPES={CHUNK:0},Leo.cycleCallback=function(){},Leo=null!=window.Leo?window.Leo:window.Leo={},Leo.event={},Leo.event._keydown=function(a){var b,c,d;if(a.ctrlKey||a.metaKey||a.preventDefault(),d=_pressedKeys.indexOf(a.keyCode),-1===d){switch(_pressedKeys.push(a.keyCode),c=Leo.util.KEY_CODES,a.keyCode){case c.S:b=Leo.layers.get("ground").serialize(),localStorage.setItem("ground",b);break;case c.L:b=localStorage.getItem("ground"),Leo.layers.get("ground").deserialize(b)}return Leo.event.keydown(a)}},Leo.event.keydown=function(){},Leo.event._keyup=function(a){var b;return a.preventDefault(),b=_pressedKeys.indexOf(a.keyCode),-1!==b&&_pressedKeys.splice(b,1),Leo.event.keyup(a)},Leo.event.keyup=function(){},Leo.io={},Leo.io.getPressedKeys=function(){return _pressedKeys},Leo.io.isKeyPressed=function(a){return"string"==typeof a&&(a=Leo.util.KEY_CODES[a.toUpperCase()]),"number"!=typeof a?!1:_pressedKeys.indexOf(a)>-1},Leo.io.anyKeyPressed=function(a){var b,c,d,e;for(c=Leo.util.KEY_CODES,"string"==typeof b&&(b=[b]),d=0,e=a.length;e>d;d++)if(b=a[d],"string"==typeof b&&(b=c[b.toUpperCase()]),_pressedKeys.indexOf(b)>-1)return!0;return!1},Leo.io.allKeysPressed=function(a){var b,c,d,e;for(c=Leo.util.KEY_CODES,"string"==typeof b&&(b=[b]),d=0,e=a.length;e>d;d++)if(b=a[d],"string"==typeof b&&(b=c[b.toUpperCase()]),-1===_pressedKeys.indexOf(b))return!1;return!0},Leo=null!=window.Leo?window.Leo:window.Leo={},Leo.Shape=Shape=function(){function a(a){var b,c,d;b={fillStyle:"rgba(255,0,0,0.4)",strokeStyle:"rgba(255,0,0,0.7)",h:1,w:1,x:0,y:0},a=Leo.util.merge(b,a);for(c in a)d=a[c],this[c]=d;Leo.shapes.push(this)}return a.prototype.draw=function(){return this.isVisible?(this.drawX=Leo.view.posToPx(this.x,"x"),this.drawY=Leo.view.posToPx(this.y,"y"),this.drawW=this.w*Leo.background.tileSize,this.drawH=this.h*Leo.background.tileSize,_frameBufferCtx.fillStyle=this.fillStyle,_frameBufferCtx.strokeStyle=this.strokeStyle,!0):!1},a}(),Leo.Rect=Rect=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.draw=function(){return b.__super__.draw.apply(this,arguments)?(_frameBufferCtx.fillRect(this.drawX,this.drawY,this.drawW,this.drawH),!0):!1},b}(Shape),Leo.Line=Line=function(a){function b(a){var c;c={x2:0,y2:0},a=Leo.util.merge(c,a),b.__super__.constructor.call(this,a)}return __extends(b,a),b.prototype.draw=function(){return b.__super__.draw.apply(this,arguments)?(_frameBufferCtx.beginPath(),_frameBufferCtx.moveTo(this.drawX,this.drawY),_frameBufferCtx.lineTo(Leo.view.posToPx(this.x2,"x"),Leo.view.posToPx(this.y2,"y")),_frameBufferCtx.closePath(),_frameBufferCtx.stroke(),!0):!1},b}(Shape),Leo=null!=window.Leo?window.Leo:window.Leo={},Leo.sprite={},Leo.sprite.Sprite=Sprite=function(){function a(a){this.spritesheet=a,this.spriteImg=this.getImg(a),this.animations={},this.currentAnimation=null}return a.prototype.addAnimation=function(a){if(!a)throw"Sprite::addAnimation - Missing animationData";if(!a.name)throw"Sprite::addAnimation - Missing animationData.name";return console.assert(!this.animations[a.name]),this.animations[a.name]=new Animation(this,a)},a.prototype.setAnimation=function(a,b){return null==b&&(b=0),this.currentAnimation=a,this.animations[this.currentAnimation].jumpToFrame(b)},a.prototype.advanceAnimation=function(a){return this.animations[this.currentAnimation].advance(a)},a.prototype.getCurrentAnimation=function(){return this.animations[this.currentAnimation]},a.prototype.draw=function(a,b){var c,d;return c=this.animations[this.currentAnimation].getCurrentFrame(),d=c.data,_frameBufferCtx.drawImage(this.spriteImg,d[0],d[1],d[2],d[3],Leo.view.posToPx(a,"x")+d[4],Leo.view.posToPx(b,"y")+d[5],d[2],d[3])},a.prototype.getImg=function(){var a,b,c;return a=this.spritesheet,(b=this._img[a])?b[a]:(c=this._img[a]=new Image,c.src=Leo.core.imgPath+a,c)},a.prototype._img={},a}(),Leo.sprite.Animation=Animation=function(){function a(a,b){var c,d,e,f,g;if(c={isLooping:!1},this.options=Leo.util.merge(c,b),!(a instanceof Sprite))throw"Missing animation sprite";for(this.sprite=a,this.frameTimeLeft=0,this.frameNum=0,this.name=b.name,this.frames=[],g=this.options.frames,e=0,f=g.length;f>e;e++)d=g[e],this.addFrame(d)}return a.prototype.addFrame=function(a){if(a instanceof Frame||(a=new Frame(a)),!(a instanceof Frame))throw"Animation::addFrame - Missing Frame";return this.frames.push(a)},a.prototype.advance=function(a){var b,c;for(b=this.frames.length-1,this.frameNum=Math.min(this.frameNum,b),this.frameTimeLeft-=a,c=[];this.frameTimeLeft<0;)this.frameNum++,this.frameNum>b&&(this.options.isLooping?this.frameNum=0:this.frameNum--),c.push(this.frameTimeLeft=this.frames[this.frameNum].data[6]+this.frameTimeLeft);return c},a.prototype.jumpToFrame=function(a){return a=Math.min(a,this.frames.length-1),a=Math.max(a,0),this.frameNum=a,this.frameTimeLeft=this.frames[a].data[6]},a.prototype.getCurrentFrame=function(){return this.frames[this.frameNum]},a}(),Leo.sprite.Frame=Frame=function(){function a(a){var b;b={x:0,y:0,w:16,h:16,offsetX:0,offsetY:0,duration:200},a=Leo.util.merge(b,a),this.data=[a.x,a.y,a.w,a.h,a.offsetX,a.offsetY,a.duration]}return a}(),Leo=null!=window.Leo?window.Leo:window.Leo={},Leo.collision={},Leo.collision.actorToLayer=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;for(q={reposition:!1},q=Leo.util.merge(q,c),g={any:!1,bottom:!1,top:!1,left:!1,right:!1,friction:1},m=a.posX,n=a.posY,o=a.speedX,p=a.speedY,r=a.posX>>0,h=a.posX+a.colW>>0,s=a.posY>>0,i=a.posY+a.colH>>0,v=w=s;i>=s?i>=w:w>=i;v=i>=s?++w:--w)for(u=x=r;h>=r?h>=x:x>=h;u=h>=r?++x:--x)t=b.getTile(u,v),t>-1&&(0===a.speedX?j=!1:0===a.speedY?j=!0:(d={},e={},a.speedX>0?(d.x=a.posX+a.colW,e.x=u):(d.x=a.posX,e.x=u+1),a.speedY>0?(d.y=a.posY+a.colH,e.y=v):(d.y=a.posY,e.y=v+1),k=Math.abs(a.speedY/a.speedX),f=Math.abs((d.y-e.y)/(d.x-e.x)),j=.01>k-f?!0:!1),j?a.speedX>0?(l=b.getTile(u,v,-1,0),-1===l?(m=u-a.colW-.01,o=0,g.any=!0,g.right=!0,Leo.view.drawOnce({shape:"Line",x:u,y:v,x2:u,y2:v+1,strokeStyle:"rgba(0,128,0,0.9)"})):Leo.view.drawOnce({shape:"Line",x:u,y:v,x2:u,y2:v+1,strokeStyle:"rgba(255,64,0,0.6)"})):(l=b.getTile(u,v,1,0),-1===l?(m=u+1,o=0,g.any=!0,g.left=!0,Leo.view.drawOnce({shape:"Line",x:u+1,y:v,x2:u+1,y2:v+1,strokeStyle:"rgba(0,128,0,0.9)"})):Leo.view.drawOnce({shape:"Line",x:u+1,y:v,x2:u+1,y2:v+1,strokeStyle:"rgba(255,64,0,0.6)"})):a.speedY<0?(l=b.getTile(u,v,0,1),-1===l?(n=v+1,p=0,g.any=!0,g.top=!0,Leo.view.drawOnce({shape:"Line",x:u,y:v+1,x2:u+1,y2:v+1,strokeStyle:"rgba(0,128,0,0.9)"})):Leo.view.drawOnce({shape:"Line",x:u,y:v+1,x2:u+1,y2:v+1,strokeStyle:"rgba(255,64,0,0.6)"})):a.speedY>0&&(l=b.getTile(u,v,0,-1),-1===l?(n=v-a.colH,p=0,g.any=!0,g.bottom=!0,Leo.view.drawOnce({shape:"Line",x:u,y:v,x2:u+1,y2:v,strokeStyle:"rgba(0,128,0,0.9)"})):Leo.view.drawOnce({shape:"Line",x:u,y:v,x2:u+1,y2:v,strokeStyle:"rgba(255,64,0,0.6)"})),Leo.view.drawOnce(-1===l?{shape:"Rect",x:u,y:v,w:1,h:1,fillStyle:"rgba(0,255,0,0.6)"}:{shape:"Rect",x:u,y:v,w:1,h:1,fillStyle:"rgba(255,255,0,0.5)"}));return q.reposition&&(a.posX=m,a.posY=n,a.speedX=o,a.speedY=p),g},Leo=null!=window.Leo?window.Leo:window.Leo={},Leo.layers={},Leo.layers.objects=[],Leo.layers.add=function(a){return a instanceof Layer&&a.id&&!Leo.layers.get(a.id)?Leo.layers.objects.push(a):null},Leo.layers.get=function(a){var b,c,d,e;for(e=Leo.layers.objects,c=0,d=e.length;d>c;c++)if(b=e[c],b.id===a)return b;return null},Leo.layers.getImg=function(a){var b,c;return b=Leo.layers._img,b[a]?b[a]:(c=b[a]=new Image,c.src="_img/"+a,c)},Leo.layers.removeImg=function(a){var b;return b=Leo.layers._img,b[a]?b[a]=null:void 0},Leo.layers._img={},Leo.Layer=Layer=function(){function a(a){var b,c,d,e,f,g,h,i;this.spritesheet="",this.chunks=[{chunkOffsetX:0,chunkOffsetY:0,colBoxes:[],tileOffsetX:0,tileOffsetY:0,tiles:[]}],this.isLooping=!1,this.parallax=1;for(d in a)f=a[d],this[d]=f;for(this.spriteImg=Leo.layers.getImg(this.spritesheet),e=this,this.spriteImg.addEventListener("load",function(){var a,b,c,d;if(e.chunks)for(d=e.chunks,b=0,c=d.length;c>b;b++)a=d[b],a.redraw()}),this.layerNumTilesX=0,i=this.chunks,c=g=0,h=i.length;h>g;c=++g)b=i[c],this.chunks[c]=new Chunk(this,b),this.layerNumTilesX+=b.tiles.length+b.tileOffsetX}return a.prototype.draw=function(){var a,b,c,d,e,f,g,h,i,j;if(this.isLooping)for(a=this.chunks[0],c=Leo.view.posToPx(a.tileOffsetX+a.chunkOffsetX,"x",this.parallax),b=(Leo.view.cameraPosX/this.layerNumTilesX*this.parallax>>0)-1,c+=this.layerNumTilesX*Leo.background.tileSize*b;_camW>c;)for(i=this.chunks,e=0,g=i.length;g>e;e++)a=i[e],d=Leo.view.posToPx(a.tileOffsetY+a.chunkOffsetY,"y"),a.draw(c,d),c+=a.drawBuffer.width+a.tileOffsetXPx;else for(j=this.chunks,f=0,h=j.length;h>f;f++)a=j[f],c=Leo.view.posToPx(a.tileOffsetX+a.chunkOffsetX,"x",this.parallax),d=Leo.view.posToPx(a.tileOffsetY+a.chunkOffsetY,"y"),a.draw(c,d)},a.prototype.getTile=function(a,b,c,d){var e,f,g,h;return null==c&&(c=0),null==d&&(d=0),f=Math.floor((a+c)/this.chunks[0].width),0>f||f>this.chunks.length-1?-1:(e=this.chunks[f],g=a-e.tileOffsetX+c-e.width*f,h=b-e.tileOffsetY+d,0>g&&g>e.width||0>h&&h>e.width?-1:e.tiles[g+h*e.width]||-1)},a.prototype.setTile=function(a,b,c){var d,e,f,g;return e=a/this.chunks[0].width>>0,d=this.chunks[e],d.drawBufferDirty=!0,f=a-d.tileOffsetX-d.width*e,g=b-d.tileOffsetY,d.tiles[f+g*d.width]=c},a.prototype.serialize=function(){var a,b,c,d,e,f;for(c="",f=this.chunks,d=0,e=f.length;e>d;d++)a=f[d],c+=String.fromCharCode(Leo.core.DATA_TYPES.CHUNK),b=a.serialize(),c+=String.fromCharCode(b.length)+b;return c},a.prototype.deserialize=function(a){var b,c,d,e,f,g;for(b=0,this.chunks.length=0,f=Leo.core.DATA_TYPES,c=0,g=[];c<a.length;){switch(d=a.charCodeAt(c+1),a.charCodeAt(c)){case f.CHUNK:e=this.chunks.push(new Chunk(this,{width:30,height:17,chunkOffsetX:b,chunkOffsetY:0,tileOffsetX:0,tileOffsetY:13})),this.chunks[e-1].deserialize(a.substr(c+2,d)),b+=30}g.push(c+=2+d)}return g},a}(),Leo.Chunk=Chunk=function(){function a(a,b){var c,d;this.tiles=[];for(d in b)c=b[d],this[d]=c;this.layer=a,this.drawBuffer=document.createElement("canvas"),this.drawBufferCtx=this.drawBuffer.getContext("2d"),this.drawBufferDirty=!0,this.drawBuffer.width=this.width*Leo.background.tileSize,this.drawBuffer.height=(this.tiles.length/this.width>>0)*Leo.background.tileSize,this.tileOffsetXPx=this.tileOffsetX*Leo.background.tileSize}return a.prototype.draw=function(a,b){var c,d,e,f,g;if(!(a<-this.drawBuffer.width||a>_camW||b<-this.drawBuffer.height||b>_camH)){if(this.drawBufferDirty){for(this.drawBufferCtx.clearRect(0,0,this.drawBuffer.width,this.drawBuffer.height),c=f=0,g=this.tiles.length;g>=0?g>=f:f>=g;c=g>=0?++f:--f)d=c%this.width,e=c/this.width>>0,this.drawTile(this.drawBufferCtx,this.tiles[c],d*Leo.background.tileSize,(e+this.chunkOffsetY)*Leo.background.tileSize);this.drawBufferDirty=!1}return _frameBufferCtx.drawImage(this.drawBuffer,0,0,this.drawBuffer.width,this.drawBuffer.height,a,b,this.drawBuffer.width,this.drawBuffer.height)}},a.prototype.redraw=function(){return this.drawBufferDirty=!0},a.prototype.drawTile=function(a,b,c,d){var e,f,g,h;if(-1!==b)return h=Leo.background.tileSize,e=16,f=b%e,g=b/e>>0,a.drawImage(this.layer.spriteImg,f*h,g*h,h,h,c>>0,d>>0,h,h)},a.prototype.serialize=function(){var a,b,c,d,e;for(a="",e=this.tiles,c=0,d=e.length;d>c;c++)b=e[c],a+=String.fromCharCode(b+1);return a},a.prototype.deserialize=function(a){var b,c,d;for(this.drawBufferDirty=!0,this.tiles.length=0,b=c=0,d=a.length;d>=0?d>=c:c>=d;b=d>=0?++c:--c)this.tiles.push(a.charCodeAt(b)-1);return this.drawBuffer.height=(this.tiles.length/this.width>>0)*Leo.background.tileSize},a}(),Leo=null!=window.Leo?window.Leo:window.Leo={},Leo.Actor=Actor=function(){function a(a){var b,c;this.posX=0,this.posY=0,this.speedX=0,this.speedY=0;for(b in a)c=a[b],this[b]=c;Leo.actors.push(this)}return a.prototype.draw=function(){return this.sprite.draw(this.posX,this.posY)},a.prototype.setSprite=function(a){if(!(a instanceof Sprite))throw"Actor::setSprite - Missing Sprite";return this.sprite=a},a.prototype.update=function(a){return this.sprite.advanceAnimation(a),this.posX+=this.speedX*a,this.posY+=this.speedY*a},a.prototype.decelerate=function(a,b){var c,d;if(b)return a=a.toUpperCase(),d="speed"+a,c=this[d],this[d]=c>0?Math.max(c-b,0):Math.min(c+b,0)},a}(),Leo=null!=window.Leo?window.Leo:window.Leo={},Leo.Player=Player=function(a){function b(){b.__super__.constructor.apply(this,arguments),this.accX=0,this.dirPhysical=0,this.dirVisual=1,this.state=new PlayerStateStanding(this),this.stateBefore=null}return __extends(b,a),b.prototype.setState=function(a){return this.state instanceof a?void 0:(this.stateBefore=this.state,this.state=new a(this))},b.prototype.stateIs=function(a){return this.state instanceof a},b.prototype.handleInput=function(a){return this.state.handleInput(a)},b.prototype.update=function(a){var c;return this.speedY+=Leo.environment.gravity*a,this.speedX+=this.accX*a,this.speedX=Math.min(this.speedX,this.speedXMax),this.speedX=Math.max(this.speedX,-this.speedXMax),b.__super__.update.call(this,a),this.state.update(a),c=Leo.collision.actorToLayer(this,Leo.layers.get("ground"),{reposition:!0}),c.bottom?0===this.dirPhysical?(this.setState(PlayerStateStanding),this.decelerate("x",c.friction*this.decelerationGround*a)):this.setState(PlayerStateRunning):this.stateIs(PlayerStateJumping)||(this.setState(PlayerStateFalling),0!==this.dirPhysical)?void 0:this.decelerate("x",this.decelerationAir*a)},b}(Actor),Leo.PlayerState=PlayerState=function(){function a(a){this.parent=a}return a.prototype.handleInput=function(a){var b;switch(b=Leo.util.KEY_CODES,a.keyCode){case b.LEFT:return this.parent.dirPhysical=-1,this.parent.dirVisual=-1;case b.RIGHT:return this.parent.dirPhysical=1,this.parent.dirVisual=1}},a.prototype.update=function(){},a}(),Leo.PlayerStateGround=PlayerStateGround=function(a){function b(a){b.__super__.constructor.call(this,a)}return __extends(b,a),b.prototype.handleInput=function(a){var c;if(b.__super__.handleInput.call(this,a),c=Leo.util.KEY_CODES,"keydown"===a.type)switch(a.keyCode){case c.UP:case c.Z:return this.parent.setState(PlayerStateJumping)}},b}(PlayerState),Leo.PlayerStateStanding=PlayerStateStanding=function(a){function b(a){b.__super__.constructor.call(this,a),this.parent.accX=0,this.parent.sprite.setAnimation(this.parent.dirVisual>0?"standingRight":"standingLeft")}return __extends(b,a),b.prototype.handleInput=function(a){var c;if(b.__super__.handleInput.call(this,a),c=Leo.util.KEY_CODES,"keydown"===a.type)switch(a.keyCode){case c.LEFT:case c.RIGHT:return this.parent.setState(PlayerStateRunning)}},b}(PlayerStateGround),Leo.PlayerStateRunning=PlayerStateRunning=function(a){function b(a){b.__super__.constructor.call(this,a),this._setSpeedAndAnim(),this.parent.stateBefore instanceof PlayerStateAir&&this.parent.sprite.getCurrentAnimation().jumpToFrame(1)}return __extends(b,a),b.prototype.handleInput=function(a){var c,d,e;if(b.__super__.handleInput.call(this,a),c=Leo.util.KEY_CODES,"keydown"===a.type)switch(a.keyCode){case c.LEFT:case c.RIGHT:return this._setSpeedAndAnim()}else if("keyup"===a.type)switch(a.keyCode){case c.LEFT:case c.RIGHT:return e=Leo.io.isKeyPressed(c.RIGHT),d=Leo.io.isKeyPressed(c.LEFT),d||e?d&&!e?(this.parent.dirPhysical=-1,this.parent.dirVisual=-1,this._setSpeedAndAnim({frameNum:1})):(this.parent.dirPhysical=1,this.parent.dirVisual=1,this._setSpeedAndAnim({frameNum:1})):(this.parent.setState(PlayerStateStanding),this.parent.dirPhysical=0,this.parent.accX=0)}},b.prototype._setSpeedAndAnim=function(a){return null==a&&(a={}),this.parent.accX=this.parent.accelerationGround*this.parent.dirPhysical,this.parent.dirVisual>0?this.parent.sprite.setAnimation("runningRight",a.frameNum):this.parent.sprite.setAnimation("runningLeft",a.frameNum)},b}(PlayerStateGround),Leo.PlayerStateAir=PlayerStateAir=function(a){function b(){b.__super__.constructor.apply(this,arguments),this.parent.sprite.setAnimation(this.parent.dirVisual>0?"jumpingRight":"jumpingLeft")}return __extends(b,a),b.prototype.handleInput=function(a){var c,d,e;if(b.__super__.handleInput.apply(this,arguments),c=Leo.util.KEY_CODES,"keydown"===a.type)switch(a.keyCode){case c.LEFT:case c.RIGHT:return this._setSpeedAndAnim()}else if("keyup"===a.type)switch(a.keyCode){case c.LEFT:case c.RIGHT:return e=Leo.io.isKeyPressed(c.RIGHT),d=Leo.io.isKeyPressed(c.LEFT),d||e?d&&!e?(this.parent.dirPhysical=-1,this.parent.dirVisual=-1,this._setSpeedAndAnim({frameNum:1})):(this.parent.dirPhysical=1,this.parent.dirVisual=1,this._setSpeedAndAnim({frameNum:1})):(this.parent.dirPhysical=0,this.parent.accX=0)}},b.prototype._setSpeedAndAnim=function(){return this.parent.accX=this.parent.accelerationAir*this.parent.dirPhysical,this.parent.sprite.setAnimation(this.parent.dirVisual>0?"jumpingRight":"jumpingLeft")},b.prototype.update=function(){return b.__super__.update.apply(this,arguments)},b}(PlayerState),Leo.PlayerStateJumping=PlayerStateJumping=function(a){function b(){b.__super__.constructor.apply(this,arguments),this.parent.speedY=-21}return __extends(b,a),b.prototype.handleInput=function(a){var c;if(b.__super__.handleInput.apply(this,arguments),c=Leo.util.KEY_CODES,"keyup"===a.type)switch(a.keyCode){case c.UP:case c.Z:return this.parent.speedY*=.5,this.parent.setState(PlayerStateFalling)}},b.prototype.update=function(){return this.parent.speedY>=0?this.parent.setState(PlayerStateFalling):void 0},b}(PlayerStateAir),Leo.PlayerStateFalling=PlayerStateFalling=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b}(PlayerStateAir),Leo=null!=window.Leo?window.Leo:window.Leo={},window.addEventListener("load",function(){var a;return Leo.core.init(),Leo.event.keydown=function(a){var b;switch(b=Leo.util.KEY_CODES,a.keyCode){case b.R:return window.location.reload();default:return Leo.player.handleInput(a)}},Leo.event.keyup=function(a){return Leo.player.handleInput(a)},a=new Leo.sprite.Sprite("sprite-olle.png"),a.addAnimation({name:"jumpingLeft",frames:[{x:19,y:33,w:30,h:32,offsetX:-4,offsetY:0,duration:.192}],isLooping:!1}),a.addAnimation({name:"jumpingRight",frames:[{x:19,y:0,w:30,h:32,offsetX:-8,offsetY:0,duration:.192}],isLooping:!1}),a.addAnimation({name:"runningLeft",frames:[{x:19,y:33,w:30,h:32,offsetX:-6,offsetY:-1,duration:.18},{x:49,y:33,w:13,h:32,offsetX:1,offsetY:0,duration:.13},{x:62,y:33,w:23,h:32,offsetX:-4,offsetY:-1,duration:.18},{x:49,y:33,w:13,h:32,offsetX:1,offsetY:0,duration:.13}],isLooping:!0}),a.addAnimation({name:"runningRight",frames:[{x:19,y:0,w:30,h:32,offsetX:-9,offsetY:-1,duration:.18},{x:49,y:0,w:13,h:32,offsetX:1,offsetY:0,duration:.13},{x:62,y:0,w:23,h:32,offsetX:-4,offsetY:-1,duration:.18},{x:49,y:0,w:13,h:32,offsetX:1,offsetY:0,duration:.13}],isLooping:!0}),a.addAnimation({name:"standingLeft",frames:[{x:0,y:33,w:19,h:32,offsetX:1,offsetY:0,duration:1}],isLooping:!1}),a.addAnimation({name:"standingRight",frames:[{x:0,y:0,w:19,h:32,offsetX:-1,offsetY:0,duration:1}],isLooping:!1}),Leo.player=new Leo.Player({sprite:a,posX:6,posY:6,colW:1,colH:2,speedXMax:9,accelerationAir:900,decelerationAir:900,accelerationGround:900,decelerationGround:900}),Leo.cycleCallback=function(){return Leo.view.cameraPosX=Leo.player.posX-15},Leo.layers.add(new Leo.Layer({id:"mountains",spritesheet:"sprite-background.png",isLooping:!0,parallax:.5,chunks:[{chunkOffsetX:0,chunkOffsetY:0,colBoxes:[],tileOffsetX:0,tileOffsetY:10,tiles:[-1,5,6,-1,-1,-1,-1,-1,-1,-1,20,21,22,23,-1,-1,-1,27,28,-1,36,37,38,39,40,-1,42,43,44,45,52,53,54,55,56,57,58,59,60,61,68,69,70,71,72,73,74,75,76,77,68,68,68,68,68,68,68,68,68,68,7,8,9,10,11,7,8,9,10,11],width:10}]})),Leo.layers.add(new Leo.Layer({id:"cloud 1",spritesheet:"sprite-background.png",isLooping:!0,parallax:.21,chunks:[{chunkOffsetX:50,chunkOffsetY:0,colBoxes:[],tileOffsetX:30,tileOffsetY:3,tiles:[0,1,2,3,16,17,18,19],width:4}]})),Leo.layers.add(new Leo.Layer({id:"cloud 2",spritesheet:"sprite-background.png",isLooping:!0,parallax:.2,chunks:[{chunkOffsetX:0,chunkOffsetY:0,colBoxes:[],tileOffsetX:29,tileOffsetY:5,tiles:[0,1,2,3,16,17,18,19],width:4}]})),Leo.layers.add(new Leo.Layer({id:"ground",spritesheet:"sprite-background.png",chunks:[{chunkOffsetX:0,chunkOffsetY:0,colBoxes:[],tileOffsetX:0,tileOffsetY:13,tiles:[-1,-1,-1,4,-1,-1,-1,-1,-1,-1,-1,32,34,33,35,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,32,33,34,33,35,-1,-1,-1,-1,-1,-1,-1,48,51,-1,-1,-1,-1,-1,-1,-1,32,33,34,33,34,33,34,33,35,48,49,50,49,50,33,34,35,-1,-1,-1,-1,48,51,-1,-1,-1,-1,32,33,34,50,49,50,49,50,49,50,49,51,48,49,50,49,50,49,50,49,34,33,34,33,50,49,34,33,34,33,50,49,50,50,49,50,49,50,49,50,49,51],width:30},{chunkOffsetX:30,chunkOffsetY:0,colBoxes:[],tileOffsetX:0,tileOffsetY:13,tiles:[-1,-1,-1,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,32,34,33,34,33,34,33,34,33,34,33,34,33,34,33,34,33,34,33,34,33,34,33,34,33,34,33,34,33,35,48,50,49,50,49,50,49,50,49,50,49,50,49,50,49,50,49,50,49,50,49,50,49,50,49,50,49,50,49,51,48,50,49,50,49,50,49,50,49,50,49,50,49,50,49,50,49,50,49,50,49,50,49,50,49,50,49,50,49,51],width:30}]}))});
//# sourceMappingURL=game.min.map